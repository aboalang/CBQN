%DEF k _k â† {ğ”½â—‹â€¢internal.Keep}
%DEF eq Eq â† â€¢internal.Indistinguishable
%DEF r1 _r1_ â† {okâ†{â‡} â‹„ _eâ†{okâˆ˜ğ”½âŠ{ğ•Š: â€¢CurrentError@}} â‹„ râ†ğ•¨(ğ”½âŸğ”¾_eâ‹ˆ(0â‰¤ğ”¾)â—¶âŸ¨ğ”½â¼,ğ”½âŸ©_e)ğ•© â‹„ {âŠ‘okâˆŠr? !"TEST FAIL: case didn't error"; â‰¢Â´r? !"TEST FAIL: repeat error differs from single iteration"â€¿r; !âŠ‘r}}
%DEF rand r â† (âŠ‘â€¢args).GetRand@

# Monadic
âŸ¨0,â†•5âŸ© {! @ â‰¡ ğ•âŸÂ¯2âŠ@ ğ•¨}âŒœ =â€¿â‰ â€¿â‰¡â€¿â‰¢â€¿â¥Šâ€¿âŠâ€¿â·â€¿âŠâ€¿Â»â€¿Â«
a â† Â¯âˆâ€¿Â¯2â€¿Â¯1â€¿1.1â€¿9.007199254740994e15 â‹„ ! -â€¿+â€¿Â¬ ({ğ•âŸğ•©a}âŒœ â‰¡ âŠ‘âŠ¸{ğ•âŸğ•©a}â‰0â€¿1) Â¯4+â†•9
a â† "hello" â‹„ ! âŠ£â€¿âŠ¢â€¿âŒ½â€¿â‰ ({ğ•âŸğ•©a}âŒœ â‰¡ âŠ‘âŠ¸{ğ•âŸğ•©a}â‰0â€¿1) Â¯4+â†•9
a â†        "hello" â‹„ ! â¥Šâ€¿âŠâ€¿â·â€¿âˆ§â€¿âˆ¨â€¿=â€¿â‰ â€¿â‰¡â€¿â‰¢â€¿â‰â€¿Â«â€¿Â» ({ğ•âŸğ•©a}âŒœ â‰¡ âŠ‘âŠ¸{ğ•âŸğ•©a}â‰0â€¿1) â†•6
a â† 3â€¿2â€¿1â¥Šâ†“"hello" â‹„ ! â¥Šâ€¿âŠâ€¿â·â€¿âˆ§â€¿âˆ¨â€¿=â€¿â‰ â€¿â‰¡â€¿â‰¢â€¿â‰â€¿Â«â€¿Â» ({ğ•âŸğ•©a}âŒœ â‰¡ âŠ‘âŠ¸{ğ•âŸğ•©a}â‰0â€¿1) â†•6
# Dyadic
âŸ¨0,â†•5âŸ© {! @ â‰¡ 3 ğ•âŸÂ¯2âŠ@ ğ•¨}âŒœ âŒŠâ€¿âŒˆâ€¿â¥Šâ€¿â†‘â€¿â‰¡â€¿â‰¢â€¿â†“â€¿Â«â€¿Â»
a â† â†•3â€¿2â€¿1 â‹„ ! âŠ¢â€¿-â€¿âŒ½â€¿â‰ ({2ğ•âŸğ•©a}âŒœ â‰¡ âŠ‘âŠ¸{2ğ•âŸğ•©a}â‰0â€¿1) Â¯4+â†•9
%USE eq â‹„ a â† Â¯âˆâ€¿Â¯2â€¿Â¯1.1â€¿1â€¿9.007199254740994e15 â‹„ ! âŸ¨-âŸ© ({ağ•âŸğ•©<a}âŒœ Eq âŠ‘âŠ¸{ağ•âŸğ•©<a}â‰0â€¿1) Â¯4+â†•9
a â† 2Ã·ËœÂ¯1+â†•5 â‹„ ! <â€¿â‰¤â€¿=â€¿â‰ â€¿â‰¥â€¿> ({ağ•âŸğ•©<a}âŒœ â‰¡ âŠ‘âŠ¸{ağ•âŸğ•©<a}â‰0â€¿1) â†•6
a â† "hello" â‹„ ! âŠ£â€¿â¥Šâ€¿â†‘â€¿<â€¿â‰¤â€¿=â€¿â‰ â€¿â‰¥â€¿>â€¿â‰¡â€¿â‰¢â€¿â†“â€¿âˆ¾â€¿Â«â€¿Â» ({1ğ•âŸğ•©a}âŒœ â‰¡ âŠ‘âŠ¸{1ğ•âŸğ•©a}â‰0â€¿1) â†•6
a â† 3â€¿2â€¿1â¥Šâ†“"hello" â‹„ ! â¥Šâ€¿â†‘â€¿â†“â€¿âŒ½â€¿â‰ ({1â€¿2ğ•âŸğ•©a}âŒœ â‰¡ âŠ‘âŠ¸{1â€¿2ğ•âŸğ•©a}â‰0â€¿1) â†•6

%USE k â‹„ (â‰âŸ(255-=) !âˆ˜â‰¡ â‰_kâŸ(255-=))Â¨ â†•Â¨â†‘4â€¿3â€¿2
â‰âŸÂ¯4(10â¥Š1)â¥Š@ %% (6â¥Š1)â¥Š@
!"â‰ğ•©: Result rank too large (255â‰¡=ğ•©)" % â‰âŸ256 @
!"â‰ğ•©: Result rank too large (255â‰¡=ğ•©)" % â‰âŸ255 â¥Š@
!"â‰ğ•©: Result rank too large (255â‰¡=ğ•©)" % â‰âŸ128 (128â¥Š1)â¥Š@
!"â‰ğ•©: Result rank too large (255â‰¡=ğ•©)" % â‰âŸ((2â‹†10)Ã—1-Ëœ2â‹†53) @
!"â‰ğ•©: Result rank too large (255â‰¡=ğ•©)" % â‰âŸ(1-Ëœ2â‹†53) â†•10
!"â‰ğ•©: Result rank too large (255â‰¡=ğ•©)" % %USE r1 â‹„ â‰_r1_(1-Ëœ2â‹†53) (255â¥Š1)â¥Š@
!"â‰â¼ğ•©: Argument must have a leading axis of 1 (2 â‰¡ â‰ ğ•©)" % â‰âŸÂ¯4 1â€¿1â€¿2â¥Š@
!"â‰â¼ğ•©: Argument must have a leading axis of 1 (0 â‰¡ =ğ•©)" % â‰âŸÂ¯4 1â€¿1â€¿1â¥Š@
!"â‰â¼ğ•©: Argument must have a leading axis of 1 (0 â‰¡ =ğ•©)" % â‰âŸÂ¯255 1â€¿1â€¿1â¥Š@
!"â‰â¼ğ•©: Argument must have a leading axis of 1 (2 â‰¡ â‰ ğ•©)" % â‰âŸ(-2â‹†63) 1â€¿1â€¿2â¥Š@
!"â‰â¼ğ•©: Argument must have a leading axis of 1 (0 â‰¡ =ğ•©)" % â‰âŸ(-2â‹†63) 1â€¿1â€¿1â¥Š@
!"â‰â¼ğ•©: Argument must have a leading axis of 1 (0 â‰¡ =ğ•©)" % %USE r1 â‹„ â‰_r1_(-2â‹†63) @
!"â‰â¼ğ•©: Argument must have a leading axis of 1 (3 â‰¡ â‰ ğ•©)" % â‰âŸÂ¯250 (3Â«240â¥Š1)â¥Š@

!"âŠğ•©: ğ•© cannot be an atom" % %USE r1 â‹„ âŠ_r1_(2â‹†31) {+}
!"âŠğ•©: ğ•© shape cannot start with 0 (âŸ¨0âŸ© â‰¡ â‰¢ğ•©)" % âŠâŸ= 0â¥ŠËœâŒ½â†•255
!"âŠğ•©: ğ•© shape cannot start with 0 (0â€¿3â€¿6 â‰¡ â‰¢ğ•©)" % âŠâŸ1e3 â†•2(-ËœâŒˆ3Ã—-)âŒ½â†•10
!"âŠğ•©: ğ•© shape cannot start with 0 (0â€¿0â€¿0â€¿0â€¿0 â‰¡ â‰¢ğ•©)" % %USE r1 â‹„ âŠ_r1_ 2 0â¥ŠËœ5â¥Š0
âŠâŸ4 @â¥ŠËœÂ¯4âŒ½â†•7 %% @â¥ŠËœâ†•3
!"âŠğ•©: ğ•© cannot be rank 0" % âŠâŸ5 2â€¿3â€¿4â¥Š5
!"âŠğ•©: ğ•© cannot be rank 0" % %USE r1 â‹„ âŠ_r1_ 5 <@
!"âŠğ•©: ğ•© cannot be rank 0" % âŠâŸ256 0â¥ŠËœ255â¥Š1
!"âŠğ•©: ğ•© cannot be rank 0" % âŠâŸ((2â‹†10)Ã—1-Ëœ2â‹†53) 0â¥ŠËœ255â¥Š1

!"Â»ğ•©: ğ•© cannot be a unit" % %USE r1 â‹„ Â»_r1_âŠ¢9
!"Â«ğ•©: ğ•© cannot be a unit" % %USE r1 â‹„ Â«_r1_âŠ¢9
Â»âŸ9e18 â†•5 %% 5â¥Š0

!"ğ•¨âŒ½ğ•©: ğ•© must have rank at least 1 for atom ğ•¨" % %USE r1 â‹„ 2 âŒ½_r1_ 5 @
!"ğ•¨âŒ½â¼ğ•©: ğ•© must have rank at least 1 for atom ğ•¨" % %USE r1 â‹„ âˆ âŒ½_r1_ Â¯2 <1
!"ğ•¨âŒ½â¼ğ•©: ğ•© cannot be an atom" % %USE r1 â‹„ âŸ¨âŸ© âŒ½_r1_ Â¯5 @
!"ğ•¨âŒ½â¼ğ•©: ğ•© cannot be an atom" % %USE r1 â‹„ 2 âŒ½_r1_ Â¯5 @
!"ğ•¨âŒ½â¼ğ•©: ğ•© cannot be an atom" % %USE r1 â‹„ 3â€¿2â€¿1 âŒ½_r1_ Â¯5 @
!"Expected integer, got Â¯5.5" % %USE r1 â‹„ Â¯5.5 âŒ½_r1_ 2 â†•10
4321â€¿9e18 âŒ½âŸ12345 8e18â€¿0â€¿7e18â¥Š0 %% 8e18â€¿0â€¿7e18â¥Š0 %USZ64
âŸ¨âŸ© âŒ½âŸ9e18 â†•2â€¿3 %% â†•2â€¿3
âŠ‘ (9e15+7) âŒ½âŸ(3e15+6) â†•100 %% 42
âŠ‘ (9e15+5â€¿3) âŒ½âŸ(3e15+7) â†•20â€¿100 %% 15â€¿21
!"ğ•¨âŒ½ğ•©: Length of list ğ•¨ must be at most rank of ğ•© (10 â‰¡ â‰ ğ•¨, âŸ¨âŸ© â‰¡ â‰¢ğ•©âŸ©" % %USE r1 â‹„ (â†•10) âŒ½_r1_ 4 5
!"ğ•¨âŒ½â¼ğ•©: Length of list ğ•¨ must be at most rank of ğ•© (10 â‰¡ â‰ ğ•¨, âŸ¨5âŸ© â‰¡ â‰¢ğ•©âŸ©" % %USE r1 â‹„ (â†•10) âŒ½â¼_r1_ 4 â†•5
!"ğ•¨âŒ½ğ•©: ğ•¨ contained non-number" % %USE r1 â‹„ âŸ¨1â€¿2,1e20âŸ©âŠ¸âŒ½_r1_ 5 2â€¿2â¥Šâ†•4
!"ğ•¨âŒ½â¼ğ•©: ğ•¨ contained non-number" % %USE r1 â‹„ âŸ¨1â€¿2,1e20âŸ©âŠ¸âŒ½_r1_ Â¯5 2â€¿2â¥Šâ†•4
!"ğ•¨âŒ½â¼ğ•©: ğ•¨ contained non-number" % %USE r1 â‹„ âŸ¨1e20,1â€¿2âŸ©âŠ¸âŒ½_r1_ Â¯5 2â€¿2â¥Šâ†•4
!"Integer out of range: 1e20" % %USE r1 â‹„ âŸ¨1e20,1e30âŸ©âŠ¸âŒ½_r1_ 5 2â€¿2â¥Šâ†•4

!"ğ•¨â†“ğ•©: Result rank too large" % %USE r1 â‹„ (256â¥Š0) â†“_r1_ 123 â†•0
!"ğ•¨â†“ğ•©: ğ•¨ must have rank at most 1 (1â€¿1â€¿256 â‰¡ â‰¢ğ•¨)" % %USE r1 â‹„ (â‰â‰256â¥Š0) â†“_r1_ 123 â†•0
â‰¢ (Ã—Â´1+2â‹†15â€¿30) â†“âŸ(1-Ëœ2â‹†15) âŸ¨2â‹†60,0âŸ©â¥Š<@ %% 1â€¿0 %USZ64
!"Expected integer, got 0.25" % %USE r1 â‹„ 0.25 â†“_r1_ 8 â†•10
!"Expected integer, got 1.5" % %USE r1 â‹„ 0â€¿1.5 â†“_r1_ 8 â†•10
1e10 â†“âŸâŠ£ â†•1e3 %% â†•0

!"ğ•¨Â»ğ•©: ğ•© cannot be a unit" % %USE r1 â‹„ 4Â»_r1_+5
!"ğ•¨Â»ğ•©: =ğ•¨ must be =ğ•© or Â¯1+=ğ•© (0â‰¡=ğ•¨, 2â‰¡=ğ•©)" % %USE r1 â‹„ (<'x')Â»_r1_ 10["ab","cd"]
!"ğ•¨Â»ğ•©: =ğ•¨ must be =ğ•© or Â¯1+=ğ•© (3â‰¡=ğ•¨, 1â‰¡=ğ•©)" % %USE r1 â‹„ (0â€¿1e4â€¿1e5â¥Š0)Â»_r1_ 10â†•0
!"ğ•¨Â»ğ•©: Lengths not matchable (âŸ¨2âŸ© â‰¡ â‰¢ğ•¨, 3â€¿3 â‰¡ â‰¢ğ•©)" % %USE r1 â‹„ 1â€¿2Â»_r1_ 10â†•3â€¿3
!"ğ•¨Â«ğ•©: ğ•© cannot be a unit" % %USE r1 â‹„ 4Â«_r1_+5
!"ğ•¨Â«ğ•©: =ğ•¨ must be =ğ•© or Â¯1+=ğ•© (0â‰¡=ğ•¨, 2â‰¡=ğ•©)" % %USE r1 â‹„ (<'x')Â«_r1_ 10["ab","cd"]
!"ğ•¨Â«ğ•©: =ğ•¨ must be =ğ•© or Â¯1+=ğ•© (3â‰¡=ğ•¨, 1â‰¡=ğ•©)" % %USE r1 â‹„ (0â€¿1e4â€¿1e5â¥Š0)Â«_r1_ 10â†•0
!"ğ•¨Â«ğ•©: Lengths not matchable (âŸ¨2âŸ© â‰¡ â‰¢ğ•¨, 3â€¿3 â‰¡ â‰¢ğ•©)" % %USE r1 â‹„ 1â€¿2Â«_r1_ 10â†•3â€¿3
'x'Â»âŸ(2â‹†54) â†•100 %% 100â¥Š'x'
(â†•7) Â«âŸ((2â‹†10)Ã—1-Ëœ2â‹†53) 100â¥Š'x' %% 100âŠ¸â¥ŠâŒ¾âŒ½â†•7

!"ğ•¨âˆ¾ğ•©: Argument ranks must differ by 1 or less (0â‰¡=ğ•¨, 255â‰¡=ğ•©)" % %USE r1 â‹„ 1âˆ¾_r1_ 6â†•255â¥Š1
!"ğ•¨âˆ¾ğ•©: Lengths not matchable (2â€¿4 â‰¡ â‰¢ğ•¨, 0â€¿5 â‰¡ â‰¢ğ•©)" % %USE r1 â‹„ (2â€¿4â¥Š0) âˆ¾_r1_ 3 0â€¿5â¥Š0
!"ğ•¨âˆ¾ğ•©: Lengths not matchable (1â€¿2â€¿4 â‰¡ â‰¢ğ•¨, 2â€¿0 â‰¡ â‰¢ğ•©)" % %USE r1 â‹„ (1â€¿2â€¿4â¥Š0) âˆ¾_r1_ 3 2â€¿0â¥Š0
!"Out of memory" % (â†•1e5) âˆ¾âŸ1e15 0
!"Out of memory" % âˆ¾âŸœ0âŸ(2â‹†54) â†•1e5
'a'âˆ¾âŸ6'b' %% "aaaaaab"
(4â€¿0â¥Š0) âˆ¾âŸ3 5â€¿0â¥Š0 %% 17â€¿0â¥Š0
(4â€¿0â¥Š0) âˆ¾ËœâŸ3 â†•0 %% 13â€¿0â¥Š0
âˆ¾ âˆ¾âŸœ(â‹ˆÂ¨"xyz")âŸ2 â‹ˆÂ¨"ab" %% "abxyzxyz"
âŸ¨Â»âŸ2 1â€¿'a'â€¿2, Â«âŸ5 1â€¿'a'â€¿2âŸ© %!PROPER_FILLS %% âŸ¨0â€¿0â€¿1, 0â€¿0â€¿0âŸ©
!"Â»ğ•©: Fill element of ğ•© not known" % %USE r1 â‹„ Â»_r1_ 2 1â€¿'a'â€¿2 %PROPER_FILLS
!"Â«ğ•©: Fill element of ğ•© not known" % %USE r1 â‹„ Â«_r1_ 5 1â€¿'a'â€¿2 %PROPER_FILLS

!"â‰â¼ğ•©: ğ•© must not be an atom" % %USE r1 â‹„ â‰_r1_ Â¯7 7
â‰âŸâŠ¢ 7 %% <7
â‰âŸÂ¯7 <7 %% <7
! â‰âŸ=âŠ¸â‰¡ (3âŒ½â†•7)â¥Š0
! (â‰âŸ(-2â‹†63) â‰¡ â‰â¼) â¥ŠâŸœ(â†•Ã—Â´)7â¥Š2

!"ğ•¨â‰ğ•©: ğ•¨ must have rank at most 1" % %USE r1 â‹„ (1â€¿1â¥Š0) â‰_r1_ 4 â†•3
!"ğ•¨â‰ğ•©: Length of ğ•¨ must be at most rank of ğ•©" % %USE r1 â‹„ 0â€¿0 â‰_r1_ 4 â†•3
!"ğ•¨â‰ğ•©: Axis 3 does not exist (3â‰¡=ğ•©)" % %USE r1 â‹„ 3 â‰_r1_ 4 â†•â†•3
!"Expected non-negative integer, got Â¯1" % %USE r1 â‹„ 0â€¿Â¯1â€¿1 â‰_r1_ 123 â†•â†•3
!"ğ•¨â‰ğ•©: Skipped result axis" % %USE r1 â‹„ 2â€¿0â€¿0 â‰_r1_ 123 â†•â†•3
!"ğ•¨â‰â¼ğ•©: ğ•© must not be an atom" % %USE r1 â‹„ 0 â‰_r1_ Â¯4 3
!"ğ•¨â‰â¼ğ•©: ğ•¨ must have rank at most 1" % %USE r1 â‹„ (1â€¿1â¥Š0) â‰_r1_ Â¯4 â†•3
!"ğ•¨â‰â¼ğ•©: Length of ğ•¨ must be at most rank of ğ•©" % %USE r1 â‹„ 0â€¿0 â‰_r1_ Â¯4 â†•3
!"ğ•¨â‰â¼ğ•©: Axis 9 does not exist (1â‰¡=ğ•©)" % %USE r1 â‹„ 9 â‰_r1_ Â¯4 â†•3
âŸ¨âŸ© â‰âŸ9e9 @ %% <@
2 â‰âŸ1e4 1â€¿1â€¿3â¥Šâ†•3 %% 1â€¿3â€¿1â¥Šâ†•3
4 â‰âŸ9876543 â¥ŠâŸœ(â†•Ã—Â´)1+â†•6 %% (Â¯3âŒ½â†•5) â‰ â¥ŠâŸœ(â†•Ã—Â´)1+â†•6
2â€¿0â€¿1 â‰âŸ1e4 1â€¿1â€¿3â€¿4â¥Šâ†•12 %% 1â€¿3â€¿1â€¿4â¥Šâ†•12
(âŒ½â†•4) â‰âŸ1111 â†•â†•5 %% (âŒ½â†•4)â‰â†•â†•5
3â€¿4â€¿6â€¿1â€¿5â€¿2â€¿0 â‰âŸ180 â¥ŠâŸœ(â†•Ã—Â´)1+â†•7 %% 2â€¿0â€¿4â€¿6â€¿3â€¿1â€¿5 â‰ â¥ŠâŸœ(â†•Ã—Â´)1+â†•7
0â€¿0 â‰âŸ5 â¥ŠâŸœ(â†•Ã—Â´)3âŒˆâ†•7 %% (4836Ã—â†•3)+âŒœâ†•6
!"ğ•¨â‰â¼ğ•©: Axis 3 does not exist (3â‰¡=ğ•©)" % %USE r1 â‹„ 0â€¿0â€¿3 â‰_r1_ Â¯2 0â€¿0â€¿0â¥Š0
%USE rand â‹„ %USE eq â‹„ âŸ¨KeepâŸ©â†â€¢internal â‹„ aaâ†â†•10000 â‹„ Râ†©r.Range â‹„ â‰ {ğ•Š: kâ†Â¯20+R 10 â‹„ wâ†(R 7) R 7 â‹„ xâ†aaâ¥ŠËœ(R 7)R 7 â‹„ kâ€¿wâ€¿x ! EqÂ´ {w ğ•âŸkâŠ{ğ•Š:â€¢CurrentError@} x}Â¨ âŸ¨â‰, âŠ¢âˆ˜â‰âŸ©}Â¨ â†•10000 %SLOW

{"foo"âŸğ•©  "bar"}Â¨ â†•4 %% "bar"â€¿"foo"â€¿"foo"â€¿"foo"
{"foo"âŸğ•©Ëœ "bar"}Â¨ â†•4 %% "bar"â€¿"foo"â€¿"foo"â€¿"foo"
{"foo"âŸğ•©  "foo"}Â¨ Â¯2+â†•5 %% 5â¥Š<"foo"
{"foo"âŸğ•©Ëœ "foo"}Â¨ Â¯2+â†•5 %% 5â¥Š<"foo"
!"â¼: Inverse does not exist" % %USE r1 â‹„ "foo"_r1_ Â¯3  "bar"
!"â¼: Inverse does not exist" % %USE r1 â‹„ "foo"_r1_ Â¯3Ëœ "bar"
!"Calling a modifier" % %USE r1 â‹„ {Â¨}_r1_ 3  "foo"
!"Calling a modifier" % %USE r1 â‹„ {Â¨}_r1_ 3Ëœ "foo"
!"Cannot invert modifier" % %USE r1 â‹„ {{ğ•˜â€¿ğ•©}}_r1_ Â¯1  "foo"
!"Cannot invert modifier" % %USE r1 â‹„ {{ğ•˜â€¿ğ•©}}_r1_ Â¯1Ëœ "foo"
